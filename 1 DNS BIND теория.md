---
создал заметку: "2025-03-09"
---

https://habr.com/ru/articles/137587/ 
и 
https://timeweb.cloud/tutorials/ubuntu/nastrojka-dns-servera-bind 

**Зона** — это любая часть дерева системы доменных имен, размещаемая как единое целое на некотором DNS-сервере. Зону, для бОльшего понимания, можно назвать «**зоной ответственности**». Целью выделения части дерева в отдельную зону является передача ответственности (**Делегирование**) за эту ветвь другому лицу или организации. На иллюстрации, примеры зон выделены синим градиентом (зона name., зона k-max.name. со всем подчиненными ресурсами, www.openoffice.org со всем подчиненными поддоменами и ресурсами). На иллюстрации выделены не все зоны, а лишь некоторые для общего понимания и представления. В каждой зоне имеется, по крайней мере, один авторитетный сервер DNS, который хранит ВСЮ информацию о зоне, за которую он отвечает.
![[Pasted image 20250309225310.png]]

**Домен** — это **именованная ветвь** или поддерево в дереве имен DNS, то есть это определенный узел, включающий в себя все подчиненные узлы. Следующая цитата из книги Linux Network Administrators Guide хорошо проясняет картину относительно разницы между зоной и доменом:

> Таким образом, пространство имен раздроблено на **зоны ( zones)**, каждая из которых управляется своим доменом. Обратите внимание на различие между **зоной (zone)** и **доменом (domain)**: домен groucho.edu затрагивает все машины в университете Groucho Marx, в то время как зона groucho.edu включает только хосты, которые работают в непосредственно компьютерном центре, например в отделе математики. Хост в отделе физики принадлежат другой зоне, а именно physics.groucho.edu.

DNS адрес **читается** **справа налево** (от корневого домена к имени хоста) в отличии от пути в файловой системе Linux. Доменное имя **начинается с точки** (корневого домена) и проходит через домены первого, второго и если нужно третьего и т.д. уровней и завершается именем хоста.

**Поддомены**, коротко говоря, это — **подчиненные домены**. По большому счету, все домены в интернете являются подчиненными за исключением корневого. Например домен k-max является поддоменом домена name, а name, в свою очередь — поддоменом корневого домена.

Итак, на схеме выше мы рассмотрели корневой домен, следующим в иерархии идут домены первого/верхнего уровня, они же **TLD**, они же **Top-Level Domain**. К данным доменам относятся национальные домены (*ru., ua. и др*) и общие домены (*com., net., и др*).


**FQDN** (англ. Fully Qualifed Domain Name, полностью определённое имя домена) — это имя домена, однозначно определяющее доменное имя и включающее в себя имена всех родительских доменов иерархии DNS, в том числе и корневого. Своеобразный аналог абсолютного пути в файловой системе.
![[Pasted image 20250309223425.png]]

**Ресурсная запись** — это единица хранения информации. Проще говоря, это запись, которая содержит связь имени с какой-либо служебной информацией. Ресурсная запись состоит из следующих элементов:
- Имя (**NAME**) — имя или IP-адрес, которому принадлежит зона. 
- Время жизни (Time to Live, **TTL**) — время хранения записи в кэше DNS, по прошествии которого запись удаляется. 
- Класс (**CLASS**) — тип сети, чаще всего **IN** — Internet.
- Тип (**TYPE**) — назначение записи
- Различная информация (**DATA**)

**A-запись.** Имя хоста на адрес IPv4. Для каждого сетевого интерфейса можно сделать только одну A-запись. 

```sh
timeweb.com.              86400     IN     A      185.114.246.105
```

**AAAA-запись.** Это то же самое, что *А-запись*, только справедливо для **IPv6**.

**CNAME.** Каноническая запись. Содержит псевдоним реального имени для перенаправления.

```sh
ftp             86400   IN      CNAME       store.cloud.timweb.com.
```

**MX**. Указывает хосты для доставки почты, адресованной домену. Поле *NAME* содержит домен назначения, а поле *DATA* — приоритет и хост для приёма почты.

```sh
website.ru.             17790   IN      MX      10 mx.website.ru.
website.ru.             17790   IN      MX      20 mx2.website.ru.
```

**NS.** Указывает на DNS-сервер, которым обслуживается домен. 

**PTR.** IP-адрес в доменное имя. Необходимо для обратного преобразования имён.

**SOA.** Описывает основные настройки зоны.

**SRV.** Содержит адреса серверов, которые обеспечивают работу внутренних служб домена. Например, Jabber.


#### **Запросы DNS**

В DNS имеются следующие **типы запросов**: итеративный (он же прямой), обратный и рекурсивный.

**Итеративный** (он же прямой, он же нерекурсивный) запрос посылает доменное имя DNS серверу и просит вернуть либо IP адрес этого домена, либо имя DNS сервера, авторитативного для этого домена. При этом, сервер DNS не опрашивает другие серверы для получения ответа. Так работают корневые и TLD серверы.

**Рекурсивный** запрос посылает DNS серверу доменное имя и просит возвратить IP адрес запрошенного домена. При этом сервер может обращаться к другим DNS серверам.

**Обратный** запрос посылает IP и просит вернуть доменное имя.

Любой DNS-server должен отвечать на итеративные запросы. Возможно настроить DNS отвечать и на рекурсивные запросы. Если DNS не настроен отвечать на рекурсивные запросы, он обрабатывает их как итеративные.

Схему **взаимодействия клиента и DNS серверов** можно представить следующей картинкой:
![[Pasted image 20250309230150.png]]

1. **Клиент** (браузер, почтовая программа, либо любое другое приложение) отправляет запрос **резолверу**, резолвер на основании указанных конфигов определяет адрес настроенного сервера имен.
2. **Резолвер** посылает запрос указанному **серверу имен**.
3. **Сервер имен** принимает данный рекурсивный запрос и, т.к. не имеет информации ни о домене, ни, возможно, даже о зоне name., отправляет рекурсивный (или нерекурсивный в зависимости от настроек) запрос серверу, **отвечающему за корневую зону**.
4. Сервер корневой зоны не обрабатывает рекурсивные запросы, в результате обрабатывает данный запрос как итеративный и возвращает имя и адрес сервера, авторитетного за зону name.
5. Сервер последовательно продолжает опрашивать авторитативные сервера для последующих зон, в порядке убывания уровня зон в имени пока не получает удовлетворительный ответ, данных шагов может быть больше, в зависимости от длины доменного имени и «вложенности» доменных имен.

В итоге, сервер получает необходимый ответ от сервера имен, хранящего необходимую ресурсную запись о хосте.

Сервер провайдера локальной сети возвращает резолверу клиента запрошенные данные.

#### **Ответы DNS сервера**

Ответы DNS бывают следующего типа:

**Авторитативный ответ** (authoritative response) приходит от серверов, являющихся ответственными за зону.

**Неавторитативный ответ** (non authoritative response) приходит от серверов, которые не отвечают за зону (от кэширующих).

Ответ DNS обычно содержит следующую информацию:
**Запись заголовка** — служебную информацию о запросе.
**Запись запроса** — повторяет отправленный запрос.
**Запись ответа** — собственно, сам ответ.
**Записи авторитетных серверов** — информацию об авторитетных серверах, хранящих информацию по текущему запросу.
**Дополнительную информацию** — дополнительные записи, например адреса NS-серверов.

#### **Обратное преобразование имен**

DNS используется в первую очередь для преобразования **доменных имён в IP-адреса**, но он также может выполнять обратный процесс, называемый **Обратное преобразование имен** или **обратным отображением**. Т.к. записи в прямой базе DNS структурированы иерархически по доменным именам, DNS не может эффективно выполнять поиск по IP адресу в такой базе. Для обратного преобразования в DNS используется специальный домен **in-addr.arpa.** Ресурсные записи в данном домене в поле Name содержат IP-адреса, в поле Type — PTR, а в поле Data — FQDN-имя соответствующее данному IP.

На схеме представлена структура домена arpa. Думаю, что тут все довольно наглядно. Домен arpa. имеет 2 поддомена in-addr и ip6, отвечающие за IPv4 и IPv6 адреса соответственно. Домен in-addr.arpa. имеет от
`*.0.in-addr.arpa. до *.255.in-addr.arpa.` поддоменов, каждый из которых так же имеет по 256 поддоменов.

![[Pasted image 20250309230853.png]]

#### **Регистрация доменных имен**

Регистрация доменов — это действие, посредством которого клиент сообщает регистратору, каким DNS-серверам следует делегировать поддомен, и также снабжает регистратора контактной и платежной информацией. Регистратор передает информацию в соответствующий реестр. Чаще всего, это процесс внесения в реестр зоны первого уровня (то есть в TLD зоны ru, com или др.), записи о новом доменном подимени.

Регистратор доменных имён — это организация, имеющая полномочия создавать (регистрировать) новые доменные имена и продлевать срок действия уже существующих доменных имён в домене, для которого установлена обязательная регистрация.

Уровни доменов, для которых необходима обязательная регистрация лица, ответственного за домен, следующие:
корневой домен
все домены первого уровня (TLD)
некоторые домены второго уровня (например, com.ru или co.uk)

Регистратором для корневого домена является организация ICANN. Чтобы стать регистратором доменов в зонах второго уровня (.com .net .org .biz .info .name .mobi .asia .aero .tel .travel .jobs ...), необходимо получить аккредитацию ICANN.

Правила регистрации в международных (gTLD — com., org, и др.) доменах устанавливаются ICANN. Правила регистрации в национальных (ccTLD — ru, us и др.) доменах устанавливаются их регистраторами и/или органами власти соответствующих стран, например единые правила для всех регистраторов в доменах .ru, и.рф задаются Координационным центром национального домена сети Интернет. Для многих доменов (в том числе и для ru) регистратор не единственный. При наличии нескольких регистраторов все они должны использовать единую (централизованную или распределённую) базу данных для исключения конфликтов и обеспечения уникальности доменного имени